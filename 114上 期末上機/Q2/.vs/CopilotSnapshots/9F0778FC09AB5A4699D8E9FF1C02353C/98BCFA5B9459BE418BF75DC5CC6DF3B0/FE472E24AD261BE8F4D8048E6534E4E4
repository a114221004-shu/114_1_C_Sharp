using System;
using System.Windows.Forms;

namespace Q2
{
    public partial class Form1 : Form
    {
        // prices
        private const decimal PRICE_OIL = 780m;
        private const decimal PRICE_LUBE = 540m;
        private const decimal PRICE_RADIATOR = 900m;
        private const decimal PRICE_TRANS = 2400m;
        private const decimal PRICE_INSPECT = 450m;
        private const decimal PRICE_MUFFLER = 3000m;
        private const decimal PRICE_TIRE = 600m;
        private const decimal LABOR_RATE = 600m; // NT$600 per hour (updated)
        private const decimal TAX_RATE = 0.06m; // 6% for parts only

        public Form1()
        {
            InitializeComponent();
        }

        private void btnCalc_Click(object sender, EventArgs e)
        {
            try
            {
                decimal serviceItems = 0m;
                if (oilchangeCheckBox.Checked) serviceItems += PRICE_OIL;
                if (lubeCheckbox.Checked) serviceItems += PRICE_LUBE;
                if (radiatorCheckBox.Checked) serviceItems += PRICE_RADIATOR;
                if (transCheckBox.Checked) serviceItems += PRICE_TRANS;
                if (inspectCheckBox.Checked) serviceItems += PRICE_INSPECT;
                if (mufflerCheckBox.Checked) serviceItems += PRICE_MUFFLER;
                if (tireCheckBox.Checked) serviceItems += PRICE_TIRE;

                // parse parts
                decimal parts = 0m;
                if (!string.IsNullOrWhiteSpace(partsTextbox.Text))
                {
                    if (!decimal.TryParse(partsTextbox.Text, out parts) || parts < 0)
                    {
                        MessageBox.Show("請在零件欄位輸入有效的非負數字。", "輸入錯誤", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                        return;
                    }
                }

                // parse hours
                decimal hours = 0m;
                if (!string.IsNullOrWhiteSpace(hoursTextbox.Text))
                {
                    if (!decimal.TryParse(hoursTextbox.Text, out hours) || hours < 0)
                    {
                        MessageBox.Show("請在工時欄位輸入有效的非負數字。", "輸入錯誤", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                        return;
                    }
                }

                decimal laborCost = hours * LABOR_RATE;
                decimal serviceAndLabor = serviceItems + laborCost;

                decimal tax = Math.Round(parts * TAX_RATE, 2);
                decimal total = Math.Round(serviceAndLabor + parts + tax, 2);

                txtServiceLabor.Text = serviceAndLabor.ToString("F2");
                txtPartsCost.Text = parts.ToString("F2");
                txtTax.Text = tax.ToString("F2");
                txtTotal.Text = total.ToString("F2");
            }
            catch (Exception ex)
            {
                MessageBox.Show("發生錯誤: " + ex.Message, "錯誤", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }

        private void btnClear_Click(object sender, EventArgs e)
        {
            // clear checkboxes
            oilchangeCheckBox.Checked = false;
            lubeCheckbox.Checked = false;
            radiatorCheckBox.Checked = false;
            transCheckBox.Checked = false;
            inspectCheckBox.Checked = false;
            mufflerCheckBox.Checked = false;
            tireCheckBox.Checked = false;

            // clear textboxes
            partsTextbox.Text = string.Empty;
            hoursTextbox.Text = string.Empty;
            txtServiceLabor.Text = string.Empty;
            txtPartsCost.Text = string.Empty;
            txtTax.Text = string.Empty;
            txtTotal.Text = string.Empty;
        }

        private void btnExit_Click(object sender, EventArgs e)
        {
            this.Close();
        }

        private void labelHours_Click(object sender, EventArgs e)
        {
            // no-op
        }

        private void labelTax_Click(object sender, EventArgs e)
        {
            // no-op
        }
    }
}
